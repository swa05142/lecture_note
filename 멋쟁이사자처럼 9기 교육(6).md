### 템플릿 상속

header나 footer 같이 상속하는 것을 코드를 중복하지 않고 한번만 사용하여 나타내는 것



#### 방법

bootstrap을 이용하여 원하는 nav바 코드 복사

base.html이라는 템플릿을 만들고 다른 html 파일에 base.html을 호출하여 동일 템플릿 적용

{% block content %} {% endblock %} 구문



base.html

```html
`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fisrtproject</title>
    
    <!--부트스트랩 CDN-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
   
    <style>
        body{text-align:center;}
    </style>
</head>
   
<body>
    <h1>메인 페이지</h1>
    <!-- nav bar-->
    <ul class="nav">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Active</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
        </li>
      </ul>
    
    <div class="container">
        {% block content %}
        {% endblock %}
    </div>
    
</body>
</html>
```



home.html

```html
{% extends 'base.html'%} <!--상속선언-->


{% block content %} <!--여기서부터-->

<h1>메인 페이지</h1>
 
<div><a href ="{%url 'new'%}">write blog</a></div>

<div class ="container">
    {%for blog in blogs%} 
    <h4>{{blog.title}}
    {{blog.summary}} <a href = "{%url 'detail' blog.id%}">..more</a> 
    <br>
    {%endfor%}
</div>

{% endblock%}<!--여기까지-->
```



#### Path 관리하는 법

코딩을 하다보면 urls.py가 쌓이는데, 이는 App 별로 묶어서 관리하면 쉽게 해결할 수 있음

App 폴더에 urls.py 파일을 생성하고, 기존 urls.py를 복사-> 붙여넣기 하여 갖고온다.



그 후 urls.py의 경우 아래와 같이 변경해준다.

```
#In BlogProject.urls.py
from django.contrib import admin
from django.urls import path,include

from blog.views import mainPage

urlpatterns = [
    path('admin/', admin.site.urls),
    path('',mainPage,name='mainPage'), 
 	path('blog/',include('blog.urls')),
]
```



+++++++++++++++++++++++++++



### Static

#### 장고에서 다루는 파일

정적 파일 and 동적 파일

정적 파일(Static) 

+  미리 서버에 저장되어 있는 파일, 서버에 저장된 그대로를 서비스해주는 파일
+ 개발자가 서버를 개발할 때 미리 넣어놓은 정적파일(img,js,css)

동적 파일 (Media) 

+ 서버의 데이터들이 어느정도 가공된 다음 보여지는 파일 (상황에 따라 달라질 수 있음)
+ 사용자가 업로드할 수 있는 파일



#### 실습

1. app 폴더안에 static 폴더 생성

2. static 폴더안에 png 파일 드래그앤 드롭

3. settings.py에서 static 항목 추가

4. base.html에서 {% load static %}

5. <img src="{% static 'likelion.png' %}" alt="">

   

```python
# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.2/howto/static-files/

STATIC_URL = '/static/'

STATICFILES_DIRS = [
    os.path.join(BASE_DIR,'firstapp','static')
    #현재 static 파일들이 어디에 있는지
    
]

STATIC_ROOT = os.path.join(BASE_DIR, 'static')

# Default primary key field type
# https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

```



+++++++++++++

### Media



#### media 루트

```python
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
#이용자가 업로드한 파일을 모으는 곳
MEDIA_URL = '/media/'
```



Models.py

클래스 blog 안에

```
image= models.ImageField(upload_to= "blog/")
```

장고는 웹프레임워크이기에 pillow라는 모듈 설치

```
pip install pillow
```



#### new.html

```html
<!--In new.html-->
<h1>글을 작성해주시요</h1>

<form action="{%url 'create'%}" method="post" enctype="multipart/form-data"> 
    {%csrf_token%}
    <p>제목: <input type="text" name="title"></p>
    <p>작가: <input type="text" name="writer"></p>
    <p>사진: <input type="file" name="image"></p>
    내용:<textarea name="body" id="" cols="30" rows="10"></textarea>
    <button type="submit">저장</button>
</form>
{% endblock %}
```



 Media 파일은 서버에 저장되어있고 유저에게는 url을 통해 보여주기에 url을 사용함.

.models.py에 만들어둔 image 에는 이미지 자체 데이터가 아닌 이미지의 url 저장해두기에 객체명.image.url 참조



+++++++++++

### Form

장고에서 제공해주는 FORM

Form 태그의 Form 맞음

데이터베이스 형식에 맞게끔 해주는 파일 forms.py를 따로 운용

App에 forms.py 생성

```python
from django import forms
from .models import firstapp

class BlogForm(forms.ModelForm):
    class Meta:
        model = firstapp
        fields = ['title','writer','body','image']
```

vies.py로 이동하여 new.html에 폼 적용

```python
from .forms import BlogForm 
def new(request): 
    form = BlogForm() 
    return render(request,'new.html',{'form':form})
```

.as_p= form의 요소들을 p태그로 묶어준다는 의미

```html
<h1>글을 작성해주시요</h1>

<form action="{%url 'create'%}" method="post" enctype="multipart/form-data">
    {%csrf_token%}
    {{form}} <!--폼-->
    <!--{{form.as_p}}-->
    <button type="submit">저장</button>
</form>
```



+++++++++++++++++



### User 확장과 인증

장고에서 제공해주는 user

장고에서 제공해주는 auth

Authentication = 인증



1. 클라이언트가 서버에 회원가입 요청 = 서버에 정보 등록

2. 회원이 서버로 로그인하면 로그인 정보를 통해 해당 회원이 존재하는지 확인

3. 서버 -> 회원에게 토큰 발급

4. 회원이 서버로 토큰을 갖고 정보 요청

5. 서버는 회원에게 토큰에 해당하는 정보 제공



다음강의부터 회원가입 로그인 로그아웃 구현 예정



### 실습

```
python manage.py startapp account
```



settings.py

```
'account',
```

views.py

```python
from django.contirb.auth.forms import AuthenticationForm,UserCreationForm

if request.method == "POST": #로그인 시(데이터 송시) data 저장
        form = AuthenticationForm(requset=request,data = request.POST)
        if form.is_valid():
            username= form.cleaned_data.get("username")
            password = form.cleaned_data.get("password")
            user = authenticate(request=request,username=username,password=password)
            if user is not None: #유저가 저장되었으면
                login(request,user) #로그인 후
         return redirect("mainPage")# 홈으로 이동
    else:
        form = AuthenticationForm() #로그인 폼 제공
        return render(request,'login.html',{'form':form})
```



urls.py 생성

```
path('account/',include('account.url')),
```



templates 폴더 생성 -> login.html 생성



#### logout



```
def logout_view(request):
	logout(request)
	return redirect("home")
```



path.py

```
path('logout/',logout_view, name = "logout"),
```



home.html

```
{%if user.is_authenticated %} <!--인증된 유저라면-->
{{user.username}} <!--유저이름-->
{%endif%}
```



++++++++++++++



### 실습 2

#### 회원가입

views.py

```
def register_view(request):
	if request.method == "POST":
	form = UserCreationForm(request.POST)
	if form.is.valid():
		user = form.save()
		login(request,user)
	return redirect("home")
	else:
		form = UserCreationForm()
		return render(request,'signup.html',{'form':form})
```

urls.py

```
path('register/',register_view, name = "signup"),
```



signup.html

```
{% extends 'base.html' %}
{% block content %}

<h1>회원가입</h1>

<form action="{%url 'signup'%}" method="post"> 
    {%csrf_token%}
    {{form.as_p}}
    <button type="submit">저장</button>
</form>
{% endblock %}
```



base.html

```
    <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="{%url 'mainPage'%}"> 
              <img src="{%static 'test.PNG' %}" alt="" width="50" height="50"> 
            </a>
            {%if not user.is_authenticated %} 
            <a class="navbar-login" href="{%url 'login'%}">로그인</a>
            {%endif%}
            {%if user.is_authenticated %}
            <a class="navbar-logout" href="{%url 'logout'%}">로그아웃</a> 
            {%endif%}
            <a class="navbar-signup" href="{%url 'signup'%}">회원가입</a>
          </div>
        </div>
      </nav>
```



#### 유저 확장

models.py

```python
from django.db import models
from django.contrib.auth.models import AbstractUser

class CustomUser(AbstractUser):
    nickname = models.CharField(max_Length=100)
    university = models.CharField(max_Length=50) 
    location = models.CharField(max_Length=20) 
```

settings.py

```
AUTH_USER_MODEL = 'account.CustomUser'
```



forms.py

```
from django.contrib,auth,forms import UserCreationForm
from .models import CustomUser

class RegisterForm(UserCreationForm):
	class Meta:
		model = CustomUser
		fields = ['username','password1','password2','nickname','location','university']
```



views.py

```
UserCreationForm -> RegisterForm 으로 변경
```



++++++++++++

### Paginator

블로그 객체를 잘라서 보내주는 paginator



views.py

```
from django.core.paginator import Paginator

def home(request)
	blogs = Blog.objects.order_by('-pub_date') #나중에 쌓이는게 최신으로 뒤집힘
	blogs = Blog.objects.all()
	paginator = Paginator(blogs, 3)
	page = request.GET.get('page')
	blogs = paginator.get_page(page)
	return render(request,'home.html',{'blog':blog})
```

home.html(페이지 이동 버튼)

```
{% if blogs.has_previous %}
<a href="?page=1">처음</a>
<a href="?page= {{blogs.previous_page_number}}>이전</a>"
{% endif %}
<span>{{blogs.number}}</span>
<span>of</span>
<span>{{blogs.paginator.num_pages}}</span>
{% if blogs.has_next %}
<a href="?page={{blogs.next_page_number}}">다음</a>
<a href="?page= {{blogs.paginator.num_pages}}>이전</a>"
{% endif %}
```

